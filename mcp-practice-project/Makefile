PHONY: help install build test clean run-python run-typescript demo

help:
	@echo "Comandos disponibles:"
	@echo "  install          - Instalar todas las dependencias"
	@echo "  build           - Compilar proyectos"
	@echo "  test            - Ejecutar tests"
	@echo "  clean           - Limpiar archivos generados"
	@echo "  run-python      - Ejecutar servidor Python"
	@echo "  run-typescript  - Ejecutar servidor TypeScript"
	@echo "  demo            - Ejecutar demo completo"

install:
	@echo "ğŸ“¦ Instalando dependencias Python..."
	cd python-server && pip install -r requirements.txt
	@echo "ğŸ“¦ Instalando dependencias TypeScript (servidor)..."
	cd typescript-server && npm install
	@echo "ğŸ“¦ Instalando dependencias TypeScript (cliente)..."
	cd client-examples && npm install

build:
	@echo "ğŸ”¨ Compilando servidor TypeScript..."
	cd typescript-server && npm run build
	@echo "âœ… CompilaciÃ³n completada"

test:
	@echo "ğŸ§ª Ejecutando tests Python..."
	cd python-server && python -m pytest tests/ || echo "No tests found"
	@echo "ğŸ§ª Ejecutando tests TypeScript..."
	cd typescript-server && npm test || echo "No tests found"

clean:
	@echo "ğŸ§¹ Limpiando archivos generados..."
	rm -rf typescript-server/dist/
	rm -rf python-server/src/*.egg-info/
	rm -rf **/__pycache__/
	rm -rf **/node_modules/.cache/

run-python:
	@echo "ğŸ Iniciando servidor Python..."
	cd python-server && python server.py

run-typescript:
	@echo "ğŸ“˜ Iniciando servidor TypeScript..."
	cd typescript-server && npm run start

demo:
	@echo "ğŸ® Ejecutando demo completo..."
	@echo "AsegÃºrate de que los servidores estÃ©n compilados..."
	$(MAKE) build
	@echo ""
	@echo "ğŸ Demo Python:"
	cd client-examples && python python_client.py || echo "Error en demo Python - verifica que el servidor estÃ© funcionando"
	@echo ""
	@echo "ğŸ“˜ Demo TypeScript:"
	cd client-examples && npx tsx typescript_client.ts || echo "Error en demo TypeScript - verifica que el servidor estÃ© funcionando"

# Comandos adicionales Ãºtiles
dev-python:
	@echo "ğŸ”„ Modo desarrollo Python (con auto-reload)..."
	cd python-server && python -u server.py

dev-typescript:
	@echo "ğŸ”„ Modo desarrollo TypeScript (con auto-reload)..."
	cd typescript-server && npm run dev

setup: install build
	@echo "âœ… Setup completo - proyecto listo para usar"
	@echo ""
	@echo "ğŸš€ PrÃ³ximos pasos:"
	@echo "   make run-python      # o"
	@echo "   make run-typescript  # en terminales separadas"
	@echo "   make demo           # para probar"